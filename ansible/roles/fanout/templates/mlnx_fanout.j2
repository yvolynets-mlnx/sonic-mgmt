{# -----------------------------Start of constants------------------------------------- #}

{% set management_interface = 'mgmt0' %}
{% set vlanid_default = '1' %}
{% set vlanid_offset = 100 %}
{% set of_tableid = '0' %}
{% set of_normal_priority = '1' %}
{% set ofpvid_present = 4096 %}
{% set server_to_dut_flow_priority = '100' %}
{% set dut_to_server_flow_priority = '101' %}
{% set eth_typ_lldp = '0x88CC' %}
{% set eth_typ_slow = '0x8809' %}
{% set eth_typ_arp = '0x0806' %}
{% set eth_typ_vlan = '0x8100' %}
{% set eth_typ_test = '0x1234' %}
{% set MTU = '9216' %}

{# -----------------------------End of constants--------------------------------------- #}

{# -----------------------------Start of default params-------------------------------- #}

{% set default_eth_ports = [-1, '1/1', '1/2', '1/3', '1/4', '1/5', '1/6', '1/7', '1/8',
                            '1/9', '1/10', '1/11', '1/12', '1/13', '1/14', '1/15', '1/16',
                            '1/17', '1/18', '1/19', '1/20', '1/21', '1/22', '1/23', '1/24',
                            '1/25', '1/26', '1/27', '1/28', '1/29', '1/30', '1/31/1', '1/31/2',
                            '1/32'] %}
{% set default_of_ports = [-1, 125, 127, 121, 123, 117, 119, 113, 115,
                           109, 111, 105, 107, 101, 103, 97, 99,
                           65, 67, 69, 71, 73, 75, 77, 79,
                           81, 83, 85, 87, 89, 91, 93, 94,
                           95] %}
{% set default_port_fec = [] %}
{% set default_vlan_range = [(vlanid_offset + 1)|string, (vlanid_offset + 32)|string] %}

{# -----------------------------End of default params---------------------------------- #}

{# -----------------------------Start of port configuration---------------------------- #}

{% set arc_switchmtbc01_eth_ports = [-1, '1/9/1', '1/9/2', '1/9/3', '1/9/4', '1/11/1', '1/11/2', '1/11/3', '1/11/4',
                                     '1/13/1', '1/13/2', '1/13/3', '1/13/4', '1/15/1', '1/15/2', '1/15/3', '1/15/4',
                                     '1/17/1', '1/17/2', '1/17/3', '1/17/4', '1/19/1', '1/19/2', '1/19/3', '1/19/4',
                                     '1/21/1', '1/21/2', '1/21/3', '1/21/4', '1/23/1', '1/23/2', '1/23/3', '1/23/4',
                                     '1/32'] %}
{% set arc_switchmtbc01_of_ports = [-1, 109, 110, 111, 112, 105, 106, 107, 108,
                                    101, 102, 103, 104, 97, 98, 99, 100,
                                    65, 66, 67, 68, 69, 70, 71, 72,
                                    73, 74, 75, 76, 77, 78, 79, 80,
                                    95] %}
{% set arc_switchmtbc02_eth_ports = [-1, '1/1/1', '1/1/2', '1/1/3', '1/1/4', '1/3/1', '1/3/2', '1/3/3', '1/3/4',
                                     '1/5/1', '1/5/2', '1/5/3', '1/5/4', '1/7/1', '1/7/2', '1/7/3', '1/7/4',
                                     '1/9/1', '1/9/2', '1/9/3', '1/9/4', '1/11/1', '1/11/2', '1/11/3', '1/11/4',
                                     '1/13/1', '1/13/2', '1/13/3', '1/13/4', '1/15/1', '1/15/2', '1/15/3', '1/15/4',
                                     '1/32'] %}
{% set arc_switchmtbc02_of_ports = [-1, 125, 126, 127, 128, 121, 122, 123, 124,
                                    117, 118, 119, 120, 113, 114, 115, 116,
                                    109, 110, 111, 112, 105, 106, 107, 108,
                                    101, 102, 103, 104, 97, 98, 99, 100,
                                    95] %}
{% set arc_switch1005_eth_ports = [-1, '1/1/1', '1/1/2', '1/2/1', '1/2/2', '1/3/1', '1/3/2', '1/4/1', '1/4/2',
                                    '1/5/1', '1/5/2', '1/6/1', '1/6/2', '1/7', '1/8', '1/9', '1/10',
                                    '1/11/1', '1/11/2', '1/12/1', '1/12/2', '1/13/1', '1/13/2', '1/14/1', '1/14/2',
                                    '1/15/1', '1/15/2', '1/16/1', '1/16/2', '1/17/1', '1/17/2', '1/18/1', '1/18/2',
                                    '1/19/1', '1/19/2', '1/20/1', '1/20/2', '1/21/1', '1/21/2', '1/22/1', '1/22/2', 
                                    '1/23', '1/24', '1/25', '1/26/1', '1/27/1', '1/27/2', '1/28/1', '1/28/2',
                                    '1/29/1', '1/29/2', '1/30/1', '1/30/2', '1/31/1', '1/31/2', '1/32/1', '1/32/2',
                                    '1/26/2' ] %}
{% set arc_switch1005_of_ports = [-1, 125, 126, 127, 128, 121, 122, 123, 124,
                                    117, 118, 119, 120, 113, 115, 109, 111, 
                                    105, 106, 107, 108, 101, 102, 103, 104,
                                    97, 98, 99, 100, 65, 66, 67, 68,
                                    69, 70, 71, 72, 73, 74, 75, 76, 
                                    77, 79, 81, 83, 85, 86, 87, 88,
                                    89, 90, 91, 92, 93, 94, 95, 96,
                                    84 ] %}
{% set arc_3700c_of_ports = [-1, 20496, 20512, 20528, 20544, 20560, 20576, 20592, 20608,
                             20624, 20640, 20656, 20672, 20688, 20704, 20720, 20736,
                             20752, 20768, 20784, 20800, 20816, 20832, 20848, 20864,
                             20880, 20896, 20912, 20928, 20944, 20960, 20977, 20978,
                             20992] -%}
{% set r_panther_03_eth_ports = [-1, '1/29/1', '1/29/2', '1/29/3', '1/29/4', '1/28', '1/27', '1/26', '1/25',
                                 '1/24', '1/23', '1/22', '1/21', '1/20', '1/19', '1/18', '1/17',
                                 '1/16', '1/15', '1/14', '1/13', '1/12', '1/11', '1/10', '1/9',
                                 '1/8', '1/7', '1/6', '1/5', '1/4', '1/3', '1/2', '1/1',
                                 '1/32'] %}
{% set r_panther_03_of_ports = [-1, 89, 90, 91, 92, 87, 85, 83, 81,
                                79, 77, 75, 73, 71, 69, 67, 65,
                                99, 97, 103, 101, 107, 105, 111, 109,
                                115, 113, 119, 117, 123, 121, 127, 125,
                                95] %}
{% set r_anaconda_43_eth_ports = [-1, '1/1/1', '1/1/2', '1/1/3', '1/1/4', '1/2/1', '1/2/2', '1/2/3', '1/2/4',
                                  '1/3/1', '1/3/2', '1/4/1', '1/4/2', '1/5/1', '1/5/2', '1/6/1', '1/6/2',
                                  '1/7/1', '1/7/2', '1/8/1', '1/8/2', '1/9/1', '1/9/2', '1/10/1', '1/10/2',
                                  '1/11/1', '1/11/2', '1/12/1', '1/12/2', '1/13/1', '1/13/2', '1/14/1', '1/14/2',
                                  '1/15/1', '1/15/2', '1/16/1', '1/16/2', '1/17/1', '1/17/2', '1/18/1', '1/18/2',
                                  '1/19/1', '1/19/2', '1/20/1', '1/20/2', '1/21/1', '1/21/2', '1/22/1', '1/22/2',
                                  '1/23/1', '1/23/2', '1/24/1', '1/24/2', '1/25/1', '1/25/2', '1/26/1', '1/26/2',
                                  '1/27/1', '1/27/2', '1/28/1', '1/28/2', '1/29/1', '1/29/2', '1/30', '1/31',
                                  '1/32'] %}
{% set r_anaconda_43_of_ports = [-1, 20497, 20498, 20499, 20500, 20513, 20514, 20515, 20516,
                                 20529, 20530, 20545, 20546, 20561, 20562, 20577, 20578,
                                 20593, 20594, 20609, 20610, 20625, 20626, 20641, 20642,
                                 20657, 20658, 20673, 20674, 20689, 20690, 20705, 20706,
                                 20721, 20722, 20737, 20738, 20753, 20754, 20769, 20770,
                                 20785, 20786, 20801, 20802, 20817, 20818, 20833, 20834,
                                 20849, 20850, 20865, 20866, 20881, 20882, 20897, 20898,
                                 20913, 20914, 20929, 20930, 20945, 20946, 20960, 20976,
                                 20992] %}
{% set r_anaconda_51_of_ports = [-1, 20496, 20512, 20528, 20544, 20560, 20576, 20592, 20608,
                                 20624, 20640, 20656, 20672, 20688, 20704, 20720, 20736,
                                 20752, 20768, 20784, 20800, 20816, 20832, 20848, 20864,
                                 20880, 20896, 20912, 20928, 20944, 20960, 20977, 20978,
                                 20992] %}
{% set r_tigris_17_eth_ports = [-1, '1/1/1', '1/1/2', '1/2/1', '1/2/2', '1/3/1', '1/3/2', '1/4', '1/5/1',
                                '1/5/2', '1/6/1', '1/6/2', '1/7/1', '1/7/2', '1/8', '1/9/1', '1/9/2',
                                '1/10/1', '1/10/2', '1/11/1', '1/11/2', '1/12', '1/13/1', '1/13/2', '1/14/1',
                                '1/14/2', '1/15/1', '1/15/2', '1/16', '1/17/1', '1/17/2', '1/18/1', '1/18/2',
                                '1/19/1', '1/19/2', '1/20', '1/21/1', '1/21/2', '1/22/1', '1/22/2', '1/23/1',
                                '1/23/2', '1/24', '1/25', '1/26', '1/27/1', '1/27/2', '1/28', '1/29',
                                '1/30', '1/31/1', '1/31/2', '1/32', '1/33', '1/34', '1/35/1', '1/35/2',
                                '1/36', '1/37', '1/38', '1/39/1', '1/39/2', '1/40', '1/41/1', '1/41/2',
                                '1/42/1', '1/42/2', '1/43/1', '1/43/2', '1/44', '1/45/1', '1/45/2', '1/46/1',
                                '1/46/2', '1/47/1', '1/47/2', '1/48', '1/49', '1/50/1', '1/50/2', '1/51',
                                '1/52', '1/53', '1/54/1', '1/54/2', '1/55', '1/56', '1/57', '1/58/1',
                                '1/58/2', '1/59', '1/60', '1/61', '1/62/1', '1/62/2', '1/63/1', '1/64',
                                '1/63/2'] %}
{% set r_tigris_17_of_ports = [-1, 20497, 20498, 20513, 20514, 20529, 20530, 20544, 20561,
                               20562, 20577, 20578, 20593, 20594, 20608, 20625, 20626,
                               20641, 20642, 20657, 20658, 20672, 20689, 20690, 20705,
                               20706, 20721, 20722, 20736, 20753, 20754, 20769, 20770,
                               20785, 20786, 20800, 20817, 20818, 20833, 20834, 20849,
                               20850, 20864, 20880, 20896, 20913, 20914, 20928, 20944,
                               20960, 20977, 20978, 20992, 21008, 21024, 21041, 21042,
                               21056, 21072, 21088, 21105, 21106, 21120, 21137, 21138,
                               21153, 21154, 21169, 21170, 21184, 21201, 21202, 21217,
                               21218, 21233, 21234, 21248, 21264, 21281, 21282, 21296,
                               21312, 21328, 21345, 21346, 21360, 21376, 21392, 21409,
                               21410, 21424, 21440, 21456, 21473, 21474, 21489, 21504,
                               21490] %}

{# -----------------------------End of port configuration------------------------------ #}

{# -----------------------------Start of port fec configuration------------------------ #}

{% set r_tigris_17_port_fec = [-1, 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec',
                               'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec',
                               'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec',
                               'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec',
                               'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec',
                               'no-fec', 'no-fec', 'rs-fec', 'rs-fec', 'no-fec', 'no-fec', 'no-fec', 'rs-fec',
                               'rs-fec', 'no-fec', 'no-fec', 'no-fec', 'rs-fec', 'rs-fec', 'no-fec', 'no-fec',
                               'no-fec', 'rs-fec', 'rs-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec',
                               'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec',
                               'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec',
                               'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec',
                               'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec',
                               -1] %}
{% set arc_switch1005_port_fec = [-1, 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec',
                               'no-fec', 'no-fec', 'no-fec', 'no-fec', 'rs-fec', 'rs-fec', 'rs-fec', 'rs-fec',
                               'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec',
                               'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec',
                               'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec',
                               'rs-fec', 'rs-fec', 'rs-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec',
                               'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec', 'no-fec',
                               -1] %}

{# -----------------------------End of port fec configuration-------------------------- #}

{# -----------------------------Start of port speed configuration---------------------- #}

{% set arc_switchmtbc01_port_speed = [-1, 25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000,
                                   25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000,
                                   25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000,
                                   25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000,
                                   'auto'] %}
{% set arc_switchmtbc02_port_speed = [-1, 25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000,
                                   25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000,
                                   25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000,
                                   25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000,
                                   'auto'] %}
{% set mtbc_sonic_02_2700_port_speed = [-1, 100000, 100000, 100000, 100000, 100000, 100000, 100000, 100000,
                                   100000, 100000, 100000, 100000, 100000, 100000, 100000, 100000,
                                   100000, 100000, 100000, 100000, 100000, 100000, 100000, 100000,
                                   100000, 100000, 100000, 100000, 100000, 100000, 50000, 50000,
                                   'auto'] %}
{% set mtbc_3700c_02_port_speed = [-1, 100000, 100000, 100000, 100000, 100000, 100000, 100000, 100000,
                                   100000, 100000, 100000, 100000, 100000, 100000, 100000, 100000,
                                   100000, 100000, 100000, 100000, 100000, 100000, 100000, 100000,
                                   100000, 100000, 100000, 100000, 100000, 100000, 50000, 50000,
                                   'auto'] %}
{% set arc_switch1003_port_speed = [-1, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000,
                                    10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000,
                                    10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000,
                                    10000, 10000, 10000, 10000, 50000, 50000, 50000, 50000,
                                    'auto'] %}
{% set arc_switch1005_port_speed = [-1, 50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000,
                                    50000, 50000, 50000, 50000, 100000, 100000, 100000, 100000,
                                    50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000,
                                    50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000,
                                    50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000,
                                    100000, 100000, 100000, 50000, 50000, 50000, 50000, 50000,
                                    50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000,
                                    50000] %}
{% set arc_switch1007_port_speed = [-1, 100000, 100000, 100000, 100000, 100000, 100000, 100000, 100000,
                                    100000, 100000, 100000, 100000, 100000, 100000, 100000, 100000,
                                    25000, 25000, 25000, 25000, 50000, 50000, 100000, 100000,
                                    100000, 100000, 100000, 100000, 100000, 100000, 50000, 50000,
                                    'auto'] %}
{% set arc_switch1016_port_speed = [-1, 100000, 100000, 100000, 100000, 100000, 100000, 100000, 100000,
                                    100000, 100000, 100000, 100000, 100000, 100000, 100000, 100000,
                                    100000, 100000, 100000, 100000, 100000, 100000, 100000, 100000,
                                    100000, 100000, 100000, 100000, 100000, 100000, 50000, 50000,
                                    'auto'] %}
{% set arc_switch1035_port_speed = [-1, 40000, 40000, 40000, 40000, 40000, 40000, 40000, 40000,
                                    40000, 40000, 40000, 40000, 40000, 40000, 40000, 40000,
                                    40000, 40000, 40000, 40000, 40000, 40000, 40000, 40000,
                                    40000, 40000, 40000, 40000, 40000, 40000, 50000, 50000,
                                    'auto'] %}
{% set arc_switch1039_port_speed = [-1, 100000, 100000, 100000, 100000, 100000, 100000, 100000, 100000,
                                    100000, 100000, 100000, 100000, 100000, 100000, 100000, 100000,
                                    100000, 100000, 100000, 100000, 100000, 100000, 100000, 100000,
                                    100000, 100000, 100000, 100000, 100000, 100000, 50000, 50000,
                                    'auto'] %}
{% set r_panther_03_port_speed = [-1, 25000, 25000, 25000, 25000, 10000, 10000, 10000, 10000,
                                  10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000,
                                  10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000,
                                  10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000,
                                  'auto'] %}
{% set r_anaconda_43_port_speed = [-1, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000,
                                   50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000,
                                   50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000,
                                   50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000,
                                   50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000,
                                   50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000,
                                   50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000,
                                   50000, 50000, 50000, 50000, 50000, 50000, 100000, 100000,
                                   100000] %}
{% set r_anaconda_51_port_speed = [-1, 100000, 100000, 100000, 100000, 100000, 100000, 100000, 100000,
                                   100000, 100000, 100000, 100000, 100000, 100000, 100000, 100000,
                                   100000, 100000, 100000, 100000, 100000, 100000, 100000, 100000,
                                   100000, 100000, 100000, 100000, 100000, 100000, 50000, 50000,
                                   'auto'] %}
{% set r_tigris_17_port_speed = [-1, 50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000,
                                 50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000,
                                 50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000,
                                 50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000,
                                 50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000,
                                 50000, 50000, 100000, 100000, 50000, 50000, 50000, 100000,
                                 100000, 50000, 50000, 50000, 100000, 100000, 50000, 50000,
                                 50000, 100000, 100000, 50000, 50000, 50000, 50000, 50000,
                                 50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000,
                                 50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000,
                                 50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000,
                                 50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000,
                                 'auto'] %}
{% set mts_sonic_fanout_port_speed = [-1, 100000, 100000, 100000, 100000, 100000, 100000, 100000, 100000,
                                    100000, 100000, 100000, 100000, 100000, 100000, 100000, 100000,
                                    100000, 100000, 100000, 100000, 100000, 100000, 100000, 100000,
                                    100000, 100000, 100000, 100000, 100000, 100000, 50000, 50000,
                                    'auto'] %}

{# -----------------------------End of port speed configuration------------------------ #}

{# -----------------------------Start of params dictionary----------------------------- #}

{% set qsfp_split_2_dict = {'arc-switchmtbc01':[],
                            'arc-switchmtbc02':[],
                            'mtbc-sonic-02-2700':['1/31'],
                            'mtbc-3700c-02':['1/31'],
                            'arc-switch1003':['1/31'],
                            'arc-switch1005':['1/1', '1/2', '1/3', '1/4', '1/5', '1/6', '1/11', '1/12',
                                              '1/13', '1/14', '1/15', '1/16', '1/17', '1/18', '1/19', '1/20',
                                              '1/21', '1/22', '1/26', '1/27', '1/28', '1/29', '1/30', '1/31',
                                              '1/32'],
                            'arc-switch1007':['1/31'],
                            'arc-switch1016':['1/31'],
                            'arc-switch1035':['1/31'],
                            'arc-switch1039':['1/31'],
                            'r-panther-03':[],
                            'r-anaconda-43':['1/3', '1/4', '1/5', '1/6', '1/7', '1/8', '1/9', '1/10',
                                             '1/11', '1/12', '1/13', '1/14', '1/15', '1/16', '1/17', '1/18',
                                             '1/19', '1/20', '1/21', '1/22', '1/23', '1/24', '1/25', '1/26',
                                             '1/27', '1/28', '1/29'],
                            'r-anaconda-51':['1/31'],
                            'r-tigris-17':['1/1', '1/2', '1/3', '1/5', '1/6', '1/7', '1/9', '1/10',
                                           '1/11', '1/13', '1/14', '1/15', '1/17', '1/18', '1/19', '1/21',
                                           '1/22', '1/23', '1/27', '1/31', '1/35', '1/39', '1/41', '1/42',
                                           '1/43', '1/45', '1/46', '1/47', '1/50', '1/54', '1/58', '1/62',
                                           '1/63'],
                            'mts-sonic-fanout':['1/31']} %}

{% set qsfp_split_4_dict = {'arc-switchmtbc01':['1/9', '1/11', '1/13', '1/15', '1/17', '1/19', '1/21', '1/23'],
                            'arc-switchmtbc02':['1/1', '1/3', '1/5', '1/7', '1/9', '1/11', '1/13', '1/15'],
                            'mtbc-sonic-02-2700':[],
                            'mtbc-3700c-02':[],
                            'arc-switch1003':[],
                            'arc-switch1005':[],
                            'arc-switch1007':[],
                            'arc-switch1016':[],
                            'arc-switch1035':[],
                            'arc-switch1039':[],
                            'r-panther-03':['1/29'],
                            'r-anaconda-43':['1/1', '1/2'],
                            'r-anaconda-51':[],
                            'r-tigris-17':[],
                            'mts-sonic-fanout':[]} %}

{% set eth_ports_dict = {'arc-switchmtbc01':arc_switchmtbc01_eth_ports,
                         'arc-switchmtbc02':arc_switchmtbc02_eth_ports,
                         'mtbc-sonic-02-2700':default_eth_ports,
                         'mtbc-3700c-02':default_eth_ports,
                         'arc-switch1003':default_eth_ports,
                         'arc-switch1005':arc_switch1005_eth_ports,
                         'arc-switch1007':default_eth_ports,
                         'arc-switch1016':default_eth_ports,
                         'arc-switch1035':default_eth_ports,
                         'arc-switch1039':default_eth_ports,
                         'r-panther-03':r_panther_03_eth_ports,
                         'r-anaconda-43':r_anaconda_43_eth_ports,
                         'r-anaconda-51':default_eth_ports,
                         'r-tigris-17':r_tigris_17_eth_ports,
                         'mts-sonic-fanout':default_eth_ports} %}

{% set of_ports_dict = {'arc-switchmtbc01':arc_switchmtbc01_of_ports,
                        'arc-switchmtbc02':arc_switchmtbc02_of_ports,
                        'mtbc-sonic-02-2700':default_of_ports,
                        'mtbc-3700c-02':arc_3700c_of_ports,
                        'arc-switch1003':default_of_ports,
                        'arc-switch1005':arc_switch1005_of_ports,
                        'arc-switch1007':default_of_ports,
                        'arc-switch1016':default_of_ports,
                        'arc-switch1035':default_of_ports,
                        'arc-switch1039':default_of_ports,
                        'r-panther-03':r_panther_03_of_ports,
                        'r-anaconda-43':r_anaconda_43_of_ports,
                        'r-anaconda-51':r_anaconda_51_of_ports,
                        'r-tigris-17':r_tigris_17_of_ports,
                        'mts-sonic-fanout':default_of_ports} %}

{% set vlan_range_dict = {'arc-switchmtbc01':default_vlan_range,
                          'arc-switchmtbc02':default_vlan_range,
                          'mtbc-sonic-02-2700':default_vlan_range,
                          'mtbc-3700c-02':default_vlan_range,
                          'arc-switch1003':default_vlan_range,
                          'arc-switch1005':[(vlanid_offset + 1)|string, (vlanid_offset + 56)|string],
                          'arc-switch1007':default_vlan_range,
                          'arc-switch1016':default_vlan_range,
                          'arc-switch1035':default_vlan_range,
                          'arc-switch1039':default_vlan_range,
                          'r-panther-03':default_vlan_range,
                          'r-anaconda-43':[(vlanid_offset + 1)|string, (vlanid_offset + 64)|string],
                          'r-anaconda-51':default_vlan_range,
                          'r-tigris-17':[(vlanid_offset + 1)|string, (vlanid_offset + 96)|string],
                          'mts-sonic-fanout':default_vlan_range} %}

{% set port_fec_dict = {'arc-switchmtbc01':default_port_fec,
                        'arc-switchmtbc02':default_port_fec,
                        'mtbc-sonic-02-2700':default_port_fec,
                        'mtbc-3700c-02':default_port_fec,
                        'arc-switch1003':default_port_fec,
                        'arc-switch1005':arc_switch1005_port_fec,
                        'arc-switch1007':default_port_fec,
                        'arc-switch1016':default_port_fec,
                        'arc-switch1035':default_port_fec,
                        'arc-switch1039':default_port_fec,
                        'r-panther-03':default_port_fec,
                        'r-anaconda-43':default_port_fec,
                        'r-anaconda-51':default_port_fec,
                        'r-tigris-17':r_tigris_17_port_fec,
                        'mts-sonic-fanout':default_port_fec} %}

{% set port_speed_dict = {'arc-switchmtbc01':arc_switchmtbc01_port_speed,
                          'arc-switchmtbc02':arc_switchmtbc02_port_speed,
                          'mtbc-sonic-02-2700':mtbc_sonic_02_2700_port_speed,
                          'mtbc-3700c-02':mtbc_3700c_02_port_speed,
                          'arc-switch1003':arc_switch1003_port_speed,
                          'arc-switch1005':arc_switch1005_port_speed,
                          'arc-switch1007':arc_switch1007_port_speed,
                          'arc-switch1016':arc_switch1016_port_speed,
                          'arc-switch1035':arc_switch1035_port_speed,
                          'arc-switch1039':arc_switch1039_port_speed,
                          'r-panther-03':r_panther_03_port_speed,
                          'r-anaconda-43':r_anaconda_43_port_speed,
                          'r-anaconda-51':r_anaconda_51_port_speed,
                          'r-tigris-17':r_tigris_17_port_speed,
                          'mts-sonic-fanout':mts_sonic_fanout_port_speed} %}

{% set license_dict = {'arc-switchmtbc01':'LK2-RESTRICTED_CMDS_GEN2-43A1-4H83-REA1-288A-4QWL-0PW5-U7',
                       'arc-switchmtbc02':'LK2-RESTRICTED_CMDS_GEN2-43A7-43LN-YFMB-A88A-0VXP-TUXP-RJ',
                       'mtbc-sonic-02-2700':'LK2-RESTRICTED_CMDS_GEN2-43A3-VYT8-6UEG-888A-67UA-1WBB-FX',
                       'mtbc-3700c-02':'INVALID_LICENSE',
                       'arc-switch1003':'LK2-RESTRICTED_CMDS_GEN2-43A7-43LN-YFN5-488A-2AKD-6QCD-96',
                       'arc-switch1005':'LK2-RESTRICTED_CMDS_GEN2-43A7-43LN-YFNC-L88A-5QA1-KKDA-EL',
                       'arc-switch1007':'LK2-RESTRICTED_CMDS_GEN2-43A7-43LN-YU2D-E88A-7KLT-FWFY-MB',
                       'arc-switch1016':'LK2-RESTRICTED_CMDS_GEN2-43A2-GDD5-VTBV-488A-2MLB-TKYB-YG',
                       'arc-switch1035':'LK2-RESTRICTED_CMDS_GEN2-43A1-4H83-M6ER-X88A-0TA4-M3RG-7B',
                       'arc-switch1039':'LK2-RESTRICTED_CMDS_GEN2-43A1-4H83-KY0T-C88A-5CEP-8QUJ-PB',
                       'r-panther-03':'LK2-RESTRICTED_CMDS_GEN2-43A7-43LN-YFM9-T88A-171M-EFFE-CA',
                       'r-anaconda-43':'LK2-RESTRICTED_CMDS_GEN2-43A5-QB6F-L0JP-E88A-30JK-4234-LD',
                       'r-anaconda-51':'LK2-RESTRICTED_CMDS_GEN2-439V-6KD5-QGE0-88A4-F8PR-DKEW-6',
                       'r-tigris-17':'LK2-RESTRICTED_CMDS_GEN2-43A5-QB6F-U732-888A-0G6U-WJU1-LN',
                       'mts-sonic-fanout':'LK2-RESTRICTED_CMDS_GEN2-43A7-C1ND-30WG-T88A-1H4M-NBU2-MY'} %}

{# -----------------------------End of params dictionary------------------------------- #}

{# -----------------------------Start of params --------------------------------------- #}

{% set qsfp_split_2 = qsfp_split_2_dict[inventory_hostname] %}
{% set qsfp_split_4 = qsfp_split_4_dict[inventory_hostname] %}
{% set eth_ports = eth_ports_dict[inventory_hostname] %}
{% set of_ports = of_ports_dict[inventory_hostname] %}
{% set trunk_port = eth_ports|last %}
{% set uplink_port_id = eth_ports.index(trunk_port) %}
{% set vlan_range = vlan_range_dict[inventory_hostname]|join('-') %}
{% set port_fec = port_fec_dict[inventory_hostname] %}
{% set port_speed = port_speed_dict[inventory_hostname] %}
{% set fanout_license = license_dict[inventory_hostname] %}

{# -----------------------------End of params ----------------------------------------- #}

{# -----------------------------Start of fanout deploy function ----------------------- #}

{% macro fanout_deploy() %}
conf t

{# Disable CLI paging #}
no cli default paging enable

no lldp
no spanning-tree
ip routing
license install {{ fanout_license }}
interface {{ management_interface }} dhcp
hostname {{ inventory_hostname }}
no fae trap-group TRAP_GROUP_LLDP policer bind
no fae trap-group TRAP_GROUP_OF_CONTROLLER policer bind

{% for i in range(0, qsfp_split_2|length) %}
interface ethernet {{ qsfp_split_2[i] }} module-type qsfp-split-2 force
{% endfor %}

{% for i in range(0, qsfp_split_4|length) %}
interface ethernet {{ qsfp_split_4[i] }} module-type qsfp-split-4 force
{% endfor %}

{% for i in range(1, port_speed|length) %}
interface ethernet {{ eth_ports[i] }} speed {{ port_speed[i] }} no-autoneg force
{% endfor %}

{% for i in range(1, eth_ports|length) %}
{% if port_fec and port_fec[i] != -1 %}
interface ethernet {{ eth_ports[i] }} fec-override {{ port_fec[i] }} force
{% endif %}
interface ethernet {{ eth_ports[i] }} speed {{ port_speed[i] }} force
interface ethernet {{ eth_ports[i] }} mtu {{ MTU }} force
{% endfor %}

vlan {{ vlan_range }}
exit

{% for i in range(1, eth_ports|length-1) %}
{% set vlanid = (vlanid_offset + i)|string %}
interface ethernet {{ eth_ports[i] }} switchport mode dot1q-tunnel
interface ethernet {{ eth_ports[i] }} switchport access vlan {{ vlanid }}
{% endfor %}

interface ethernet {{ trunk_port }} switchport mode trunk
interface ethernet {{ trunk_port }} switchport trunk allowed-vlan none
interface ethernet {{ trunk_port }} switchport trunk allowed-vlan add {{ vlan_range }}
interface ethernet {{ trunk_port }} switchport trunk allowed-vlan remove {{ vlanid_default }}

protocol openflow

# Disable mac learning to avoid issue when VM MAC address appears on DUT port during SONiC port flap or restart and also issue in FDB reload test for which rules matching 0x1234 ethertype were introduces.
# The idea is that forwarding is controlled by openflow rules.
# For normal openflow rule since there are only two ports in same vlan (one access port connected to DUT, one trunk port connected to server)
# - one is always a source port and one is always a destination port, so no flooding actually occurs.
{% for i in range(1, eth_ports|length) %}
interface ethernet {{ eth_ports[i] }} openflow mode hybrid
interface ethernet {{ eth_ports[i] }} mac-learning disable
{% endfor %}

{% set of_counter = 0 -%}

{% for i in range(1, eth_ports|length-1) %}
{% set vlanid = (vlanid_offset + i)|string %}
openflow add-flows {{ of_counter + i }} table={{ of_tableid }},priority={{ server_to_dut_flow_priority }},dl_type={{ eth_typ_lldp }},in_port={{ of_ports[uplink_port_id] }},dl_vlan={{ vlanid }},actions=strip_vlan,output:{{ of_ports[i] }}
{% endfor %}

{% set of_counter = of_counter + eth_ports|length-2 -%}

{% for i in range(1, eth_ports|length-1) %}
{% set vlanid = (ofpvid_present + vlanid_offset + i)|string %}
openflow add-flows {{ of_counter + i }} table={{ of_tableid }},priority={{ dut_to_server_flow_priority }},dl_type={{ eth_typ_lldp }},in_port={{ of_ports[i] }},actions=push_vlan:{{ eth_typ_vlan }},set_field:{{ vlanid }}->vlan_vid,output:{{ of_ports[uplink_port_id] }}
{% endfor %}

{% set of_counter = of_counter + eth_ports|length-2 -%}

{% for i in range(1, eth_ports|length-1) %}
{% set vlanid = (vlanid_offset + i)|string %}
openflow add-flows {{ of_counter + i }} table={{ of_tableid }},priority={{ server_to_dut_flow_priority }},dl_type={{ eth_typ_slow }},in_port={{ of_ports[uplink_port_id] }},dl_vlan={{ vlanid }},actions=strip_vlan,output:{{ of_ports[i] }}
{% endfor %}

{% set of_counter = of_counter + eth_ports|length-2 -%}

{% for i in range(1, eth_ports|length-1) %}
{% set vlanid = (ofpvid_present + vlanid_offset + i)|string %}
openflow add-flows {{ of_counter + i }} table={{ of_tableid }},priority={{ dut_to_server_flow_priority }},dl_type={{ eth_typ_slow }},in_port={{ of_ports[i] }},actions=push_vlan:{{ eth_typ_vlan }},set_field:{{ vlanid }}->vlan_vid,output:{{ of_ports[uplink_port_id] }}
{% endfor %}

{% set of_counter = of_counter + eth_ports|length-2 -%}

{% for i in range(1, eth_ports|length-1) %}
{% set vlanid = (vlanid_offset + i)|string %}
openflow add-flows {{ of_counter + i }} table={{ of_tableid }},priority={{ server_to_dut_flow_priority }},dl_type={{ eth_typ_arp }},in_port={{ of_ports[uplink_port_id] }},dl_vlan={{ vlanid }},actions=output:{{ of_ports[i] }}
{% endfor %}

{% set of_counter = of_counter + eth_ports|length-2 -%}

{% for i in range(1, eth_ports|length-1) %}
{% set vlanid = (vlanid_offset + i)|string %}
openflow add-flows {{ of_counter + i }} table={{ of_tableid }},priority={{ dut_to_server_flow_priority }},dl_type={{ eth_typ_arp }},in_port={{ of_ports[i] }},actions=output:{{ of_ports[uplink_port_id] }}
{% endfor %}

{% set of_counter = of_counter + eth_ports|length-2 -%}

{% for i in range(1, eth_ports|length-1) %}
{% set vlanid = (vlanid_offset + i)|string %}
openflow add-flows {{ of_counter + i }} table={{ of_tableid }},priority={{ dut_to_server_flow_priority }},dl_type={{ eth_typ_test }},in_port={{ of_ports[i] }},actions=output:{{ of_ports[uplink_port_id] }}
{% endfor %}

{% set of_counter = of_counter + eth_ports|length-2 -%}

# apply normal openflow rule
openflow add-flows {{ of_counter + 1 }} table={{ of_tableid }},priority={{ of_normal_priority }},actions=normal

docker
no shutdown
exit
write memory
{% endmacro %}

{# -----------------------------End of fanout deploy function ------------------------- #}

{% if action_variable == "deploy" %}
    {{ fanout_deploy() }}
{% endif %}
